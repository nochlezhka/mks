{% block form %}
	{% import "SonataAdminBundle:CRUD:base_edit_form_macro.html.twig" as form_helper %}
	{{ sonata_block_render_event('sonata.admin.edit.form.top', { 'admin': admin, 'object': object }) }}

	{% set url = admin.id(object) is not null ? 'edit' : 'create' %}
	{% if not admin.hasRoute(url) %}
		<div>
			{{ "form_not_available"|trans({}, "SonataAdminBundle") }}
		</div>
	{% else %}

		<form
				{% if app.request.get('type') == 'custom_modal' %}
					{% set isModal = true %}
				{% else %}
					{% set isModal = false %}
				{% endif %}
				{% if sonata_admin.adminPool.getOption('form_type') == 'horizontal' %} class="form-horizontal" {% endif %} role="form" action="{% block sonata_form_action_url %}{{ admin.generateUrl(url, {'id': admin.id(object), 'uniqid': admin.uniqid, 'subclass': app.request.get('subclass'), 'isModal': isModal, 'url': app.request.headers.get('referer')}) }}{% endblock %}" {% if form.vars.multipart %} enctype="multipart/form-data" {% endif %} method="POST" {% if not sonata_admin.adminPool.getOption('html5_validate') %} novalidate="novalidate" {% endif %} {% block sonata_form_attributes %} {% endblock %}>

			{{ include('SonataAdminBundle:Helper:render_form_dismissable_errors.html.twig') }}

			{% block sonata_pre_fieldsets %}
				<div class="row">
				{% endblock %}

				{% block sonata_tab_content %}
					{% set has_tab = ((admin.formtabs|length == 1 and admin.formtabs|keys[0] != 'default') or admin.formtabs|length > 1 ) %}

					<div class="col-md-12">
						{# {{ form_helper.render_groups(admin, form, admin.formtabs['default'].groups, has_tab) }}3 #}

{#                        {% set clientId = form.vars.data.client.id %}#}
                        {# {% set clientShelterHistory =  %} #}
						<div class="row">

							{% for code in admin.formtabs['default'].groups if admin.formgroups[code] is defined %}
								{% set form_group = admin.formgroups[code] %}

								<div class="{{ form_group.class|default('col-md-12') }}">
									<div class="{{ form_group.box_class }}">
										<div class="box-header">
											<h4 class="box-title">
												{{ form_group.label|trans({}, form_group.translation_domain ?: admin.translationDomain) }}
											</h4>
										</div>
										<div class="box-body">
											<div class="sonata-ba-collapsed-fields">
												{% if form_group.description %}
													<p>{{ form_group.description|raw }}</p>
												{% endif %}
												{# {{ dump(form_group.fields) }} #}

												{% for field_name in form_group.fields if form[field_name] is defined %}
													{{ form_row(form[field_name])}}
												{% else %}
													<em>{{ 'message_form_group_empty'|trans({}, 'SonataAdminBundle') }}</em>
												{% endfor %}
											</div>
										</div>
									</div>
								</div>
							{% endfor %}
						</div>
					</div>
				{% endblock %}

				{% block sonata_post_fieldsets %}
				</div>
			{% endblock %}

			{{ form_rest(form) }}

			{% block formactions %}
				<div class="sonata-ba-form-actions well well-small form-actions">
					{% block sonata_form_actions %}
						{% if app.request.isxmlhttprequest %}
							{% if admin.id(object) is not null %}
								<button type="submit" class="btn btn-success" name="btn_update">
									<i class="fa fa-save" aria-hidden="true"></i>
									{{ 'btn_update'|trans({}, 'SonataAdminBundle') }}
								</button>
							{% else %}
								<button type="submit" class="btn btn-success" name="btn_create">
									<i class="fa fa-plus-circle" aria-hidden="true"></i>
									{{ 'btn_create'|trans({}, 'SonataAdminBundle') }}
								</button>
							{% endif %}
						{% else %}
							{% if admin.supportsPreviewMode %}
								<button class="btn btn-info persist-preview" name="btn_preview" type="submit">
									<i class="fa fa-eye" aria-hidden="true"></i>
									{{ 'btn_preview'|trans({}, 'SonataAdminBundle') }}
								</button>
							{% endif %}
							{% if admin.id(object) is not null %}
								{% if admin.hasRoute('list') and admin.hasAccess('list') %}
									{% if admin.code == "app.client.admin" %}
										<button type="submit" class="btn btn-success" name="btn_update_and_show">
											<i class="fa fa-save" aria-hidden="true"></i>
											{{ 'btn_update'|trans({}, 'SonataAdminBundle') }}
										</button>
									{% else %}
										<button type="submit" class="btn btn-success" name="btn_update_and_list">
											<i class="fa fa-save"></i>
											<i class="fa fa-list" aria-hidden="true"></i>
											{{ 'btn_update_and_return_to_list'|trans({}, 'SonataAdminBundle') }}
										</button>
									{% endif %}
								{% endif %}

								{% if admin.hasRoute('delete') and admin.hasAccess('delete', object) %}
									{{ 'delete_or'|trans({}, 'SonataAdminBundle') }}
									<a class="btn btn-danger" href="{{ admin.generateObjectUrl('delete', object) }}">
										<i class="fa fa-minus-circle" aria-hidden="true"></i>
										{{ 'link_delete'|trans({}, 'SonataAdminBundle') }}
									</a>
								{% endif %}

								{% if admin.isAclEnabled() and admin.hasRoute('acl') and admin.hasAccess('acl', object) %}
									<a class="btn btn-info" href="{{ admin.generateObjectUrl('acl', object) }}">
										<i class="fa fa-users" aria-hidden="true"></i>
										{{ 'link_edit_acl'|trans({}, 'SonataAdminBundle') }}
									</a>
								{% endif %}
							{% else %}
								{% if admin.code == "app.client.admin" %}
									<button type="submit" class="btn btn-success" name="btn_update_and_show">
										<i class="fa fa-plus-circle" aria-hidden="true"></i>
										{{ 'btn_create'|trans({}, 'SonataAdminBundle') }}
									</button>
								{% else %}
									{% if admin.hasroute('list') and admin.hasAccess('list') %}
										<button type="submit" class="btn btn-success" name="btn_create_and_list">
											<i class="fa fa-save"></i>
											<i class="fa fa-list" aria-hidden="true"></i>
											{{ 'btn_create_and_return_to_list'|trans({}, 'SonataAdminBundle') }}
										</button>
									{% endif %}
								{% endif %}
							{% endif %}
						{% endif %}
					{% endblock %}
				</div>
			{% endblock formactions %}
		</form>
	{% endif %}

	{{ sonata_block_render_event('sonata.admin.edit.form.bottom', { 'admin': admin, 'object': object }) }}
	<script>
		$(document).ready(function() {
			const _jobFields = ['field_6', 'field_5', 'field_7', 'field_8'];
			const hiddenNames = ['field_17', 'field_11', 'field_6', 'field_5', 'field_7', 'field_8', 'field_3'];

			hiddenNames.forEach((name) => {
				$('div.form-group[id*='+ name +']').hide();
				if ($('[name*=field_16]').val() == 'Нет') {
					$('div.form-group[id*=field_17]').show();
				}

				if ($('[name*=field_9]').val() != null && $('[name*=field_9]').val().indexOf('Другое') != -1 ) {
					$('div.form-group[id*=field_11]').show();
				}

				if ($('[name*=field_2]').val() == 'Да') {
					$('div.form-group[id*=field_3]').show();
				}

				if ($('[name*=field_4]').val() == 'Да') {
					_jobFields.forEach((el) => {
						$('div.form-group[id*='+el+']').show();
					});
				}
			});

			$('[name*=field_16]').on('change', function() {
				if ($(this).val() == 'Нет') {
					$('div.form-group[id*=field_17]').show();
				} else {
					$('div.form-group[id*=field_17]').hide();
					$('[name*=field_17]').val('').trigger('change');
				}
			});


			$('[name*=field_9]').on('change', function() {
				if ($(this).val() != null && $(this).val().indexOf('Другое') != -1) {
					$('div.form-group[id*=field_11]').show();
				} else {
					$('div.form-group[id*=field_11]').hide();
					$('[name*=field_17]').val('');
				}
			});

			$('[name*=field_2]').on('change', function() {
				if ($(this).val() == 'Да') {
					$('div.form-group[id*=field_3]').show();
				} else {
					$('div.form-group[id*=field_3]').hide();
					$('[name*=field_3]').val('').trigger('change');
				}
			});

			$('[name*=field_4]').on('change', function() {
				if ($(this).val() == 'Да') {
					_jobFields.forEach((el) => {
						$('div.form-group[id*='+el+']').show();
					});
					// $('div.form-group[id*=field_6]').show();
					// $('div.form-group[id*=field_5]').show();
					// $('div.form-group[id*=field_7]').show();
					// $('div.form-group[id*=field_8]').show();
				} else {
					_jobFields.forEach((el) => {
						$('div.form-group[id*='+ el +']').hide();
						$('[name*='+ el +']').val('').trigger('change');
					});
					// $('div.form-group[id*=field_6]').hide();
					// $('div.form-group[id*=field_5]').hide();
					// $('div.form-group[id*=field_7]').hide();
					// $('div.form-group[id*=field_8]').hide();
				}
			});

		});
	</script>
{% endblock %}
