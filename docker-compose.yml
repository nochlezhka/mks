version: '3.9'
services:
  nginx:
    container_name: mks-nginx
    image: nochlezhka/mks-nginx:${MKS_VERSION}
    build:
      context: ./docker/nginx
      dockerfile: Dockerfile
    links:
      - php
    ports:
      - ${PORT}:80
      - ${HTTPS_PORT}:443
    restart: always
    # TODO: temporary disabled, will be enabled by different MR
    # volumes:
    #   - "./shared/logs/nginx:/var/log/nginx"
  php:
    container_name: mks-php
    image: nochlezhka/mks-php:${MKS_VERSION}
    build:
      context: ./docker/php
      dockerfile: Dockerfile
    links:
      - db
    restart: always
  db:
    container_name: mks-db
    image: mysql:8.0.30
    profiles:
      - local
    cap_add:
      - SYS_NICE
    ports:
        - ${MYSQL_PORT}:3306
    restart: always
    # TODO: temporary disabled, will be enabled by different MR
    # volumes:
    #     - ${HOME}/sql:/docker-entrypoint-initdb.d/:rw
    #     - ${HOME}/mysql_data:/var/lib/mysql
    environment:
        MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
        MYSQL_DATABASE: ${MYSQL_DATABASE}
        MYSQL_USER: ${MYSQL_USER}
        MYSQL_PASSWORD: ${MYSQL_PASSWORD}
        TZ: Etc/GMT-3
