## Регулярное копирование БД и статических данных.

Для сохранности данных в базе данных и статического контента (фотографий и документов клиентов) рекомендуется настроить регулярное копирование сначала в локальную директорию, а потом на удаленный сервер.

Cron-задача для регулярного резервного копирования БД и статических данных

    > 0 5	 * * *  root	docker stop mks-app && mysqldump MYSQL_DATABASE -uMYSQL_USER -pMYSQL_PASSWORD -h127.0.0.1 --port MYSQL_PORT > /PATH/TO/BACKUP/DIRECTORY/mks-dbbackup-`date +\%Y\%m\%d`.sql && docker start mks-app
    > 10 5	 * * 6	root	mkdir /PATH/TO/BACKUP/DIRECTORY/`date +\%Y\%m\%d` && cp -r /PATH/TO/MKS/mks/shared/homeless/public/uploads/ /PATH/TO/BACKUP/DIRECTORY/`date +\%Y\%m\%d`

## Восстановление из резервной копии

Если возникли проблемы с базой данных, необходимо в mysql выгрузить последний дамп БД:

    > mysql MYSQL_DATABASE -uMYSQL_USER -pMYSQL_PASSWORD -h127.0.0.1 --port MYSQL_PORT < dump.sql
    > Параметры MYSQL_DATABASE, MYSQL_USER, MYSQL_PASSWORD, MYSQL_PORT необходимо поменять не те, которые указаны в файле, а dump.sql - на имя файла с последним дампом базы данных

и пройти все шаги начиная с 9 (см. [документацию](05-update.md) по обновлению)


Если не хватает каких-то данных (фотографий, документов) или к ним нет доступа, необходимо проверить, что на директорию со статическими данными `shared/homeless/public/uploads/` выставлены правильные права:

    > сhown -R USER:USER ~/shared/homeless/public/uploads/
    > вместо USER нужно указать имя пользователя, от имени которого запускается МКС

Если после этого не хватает каких-либо файлов, необходимо скопировать их из директории, в которую регулярно сохраняются копии статических данных.


## Защита данных

Если Вы используете МКС на сервере, который имеет прямой доступ в интернет, будет целесообразным настроить огранчение доступа - [basic-авторизацию](https://nginx.org/ru/docs/http/ngx_http_auth_basic_module.html).
А чтобы сотрудникам не приходилось каждый раз повторно авторизовываться, включена настроийка, чтобы с доверенных IP-адресов (например, из офиса), Nginx не требовал basic-авторизацию: директива [satisfy](http://nginx.org/ru/docs/http/ngx_http_core_module.html#satisfy).

При настройке МКС стоит использовать сложные пароли. Разные для каждой учетной записи. Лучше всего использовать пороли, которые сгенерированы случайным образом. Можно использовать генераторы паролей, например [этот](https://passwordsgenerator.net/). Лучше всего, если пароль будет длиной от 16 символов и длиннее, будет содержать как минимум буквы разного регистра и цифры. Разные сложные пароли стоит использовать не только в МКС, но и во всех учетных записях, как рабочих, так и личных.
