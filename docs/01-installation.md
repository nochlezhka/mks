# “МКС” - “многофункциональный кабинет соцработника”

“МКС” - это CRM-система для организации сопровождения клиентов и учета оказанных услуг, а также для сбора статистики. Ей могут пользоваться соцработники, юристы и другие сотрудники как НКО, так и государственных учреждений соцобслуживания.

В первую очередь, “МКС” подойдет организациям, помогающим бездомным людям - в этом случае она нуждается в минимальной настройке для нужд конкретной организации. Другие организации (например, помогающие наркопотребителям или ЛЖВ) также смогут пользоваться “МКС”, изменив список предоставляемых услуг и настроив другие разделы. Большую часть настроек можно осуществить силами простых сотрудников, без привлечения it-специалиста.

Центральным звеном системы является профиль клиента. Страница профиля  содержит анкету, информацию обо всех оказанных услугах, примечания сотрудников, автоматическую генерацию справок и других документов. К профилю можно прикрепить файлы в любых форматах, настроить напоминания, внести данные о проживании в приюте, если таковой у вас имеется. В разделе “Сервисный план” можно составить долгосрочный план сопровождения и отмечать начало и окончание работы по конкретным задачам.

У каждого сотрудника есть личный кабинет, в котором ведется учет всей рабочей активности. Удобная система поисковых фильтров позволяет найти любую информацию, когда-либо внесенную в базу.

Раздел “Отчеты” позволяет отслеживать все выполненные работы по предоставлению разовых услуг и сопровождению - как по организации в целом, так и по конкретным работникам.

Подробнее об “МКС” можно узнать, посмотрев скринкаст - https://youtu.be/f07ObZ91q8k

Если вы хотите установить “МКС”, у нас к вам две просьбы: во-первых, разворачивая систему на вашем сервере, пожалуйста, не забудьте позаботиться о защите персональных данных ваших клиентов и сотрудников. Во-вторых, заполните, пожалуйста, небольшую [анкету](https://goo.gl/forms/YjhAaqSaxAvxMKoE3), чтобы мы знали, для кого трудились :)

Будем рады обратной связи. И добро пожаловать на борт!

## Шаги установки

МКС устанавливается на ОС Linux (желательно использовать Ubuntu 18+).
Перед началом установки МКС необходимо установить docker и docker-compose, если они не были установлены до этого.

``` shell
# удаляем старый docker, если есть (нужен Community Edition)

sudo apt-get purge docker docker-engine docker.io

# обновляем индекс пакетов
sudo apt-get update

# устанавливаем необходимые пакеты
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common

# добавляем официальный GPG ключ, чтобы менеджер пакетов знал о нужном нам репозитории
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

# добавляем репозиторий со стабильной версией к списку пакетов:
sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"

# опять обновляем индекс пакетов
sudo apt-get update

# устанавливаем непосредственно docker
sudo apt-get install docker-ce

# кроме того необходимо установаить docker-compose для запуска проектов
# скачиваем его
sudo curl -L https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose

# делаем docker-compose исполняемым
sudo chmod +x /usr/local/bin/docker-compose

```

## Установка приложения

Перед установкой прочитайте [рекомендации](06-dumps.md) по защите данных.

1. Склонируйте репозиторий проекта:

    > `git clone https://github.com/nochlezhka/mks.git`

2. После клонирования перейдите в каталог проекта:

    > `cd mks`

3. Создайте локальную копию файла `.env.dist`, здесь хранятся настраиваемые параметры приложения:

    > `cp .env.dist .env`

    Обязательно нужно поменять параметры подключения к БД в .env:

    > `MYSQL_PASSWORD =`
    >
    > `MYSQL_ROOT_PASSWORD =`
    >
    > `DB_PASSWORD =`

4. Запустите сборку контейнеров (опциональный шаг)

    > `cp -r shared/homeless docker/app/files`
    >
    > `cd docker/app`
    >
    > `docker build -t nochlezhka/mks-app .`

5. Запустите МКС (в случае использования готовой версии измените `MKS_VERSION` с `latest` на предоставленную версию)

    > `export MKS_VERSION=latest`
    >
    > `docker-compose --profile=local up -d --no-build`

6. Запустите миграцию для создания первоначальной структуры базы данных и заполнения данными:

    > `docker-compose exec php ./bin/console doctrine:migrations:migrate`

7. При желании можете поменять пароль для входа в систему

    > `docker-compose exec php ./bin/console fos:user:change-password admin`

8. Настройте хост для проекта, перейдите по адресу хоста,
если пароль не был изменен на шаге 7 - залогиньтесь с доступом `admin/password`.
